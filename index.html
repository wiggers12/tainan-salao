<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Doce Sabor Caseiro</title>
  <style>
    * { box-sizing: border-box; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 0; }
    body { background: #fff0f5; color: #333; }
    .splash {
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      height: 100vh; background: #f28ab2;
      color: white; text-align: center;
    }
    .splash h1 { font-size: 3rem; margin-bottom: 20px; }
    .splash button {
      background: white; color: #f28ab2; font-size: 1.2rem;
      border: none; padding: 12px 24px; border-radius: 8px;
      cursor: pointer; box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .container { display: none; padding: 20px; }
    nav {
      display: flex; justify-content: space-around;
      background: #f28ab2; padding: 12px 0; position: sticky; top: 0;
      z-index: 10;
      flex-wrap: wrap;
      gap: 8px;
    }
    nav button {
      background: none; border: none; color: white; font-size: 1rem;
      font-weight: bold; cursor: pointer; transition: transform 0.2s;
      padding: 8px 12px;
      border-radius: 6px;
    }
    nav button:hover { transform: scale(1.05); background: #e36a8a; }

    section {
      display: none; background: white; padding: 20px;
      margin-top: 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }
    section.active { display: block; }

    h2 {
      color: #f28ab2; margin-bottom: 16px;
      border-bottom: 2px solid #f28ab2; padding-bottom: 4px;
    }

    input, select {
      width: 100%; padding: 10px; margin-bottom: 12px;
      border: 1px solid #ccc; border-radius: 8px;
      font-size: 1rem;
    }

    button.save {
      background: #f28ab2; color: white; padding: 10px 20px;
      border: none; border-radius: 8px; cursor: pointer;
      font-weight: bold;
      font-size: 1rem;
    }

    ul {
      margin-top: 10px; list-style: none; padding: 0;
      max-height: 280px; overflow-y: auto;
    }
    ul li {
      background: #ffe6ec; margin-bottom: 8px; padding: 10px;
      border-radius: 6px; box-shadow: 0 1px 4px rgba(0,0,0,0.05);
      display: flex; justify-content: space-between; align-items: center;
      font-size: 0.95rem;
    }

    .financeiro p {
      font-size: 1.1rem; margin: 10px 0;
    }
    .financeiro span {
      font-weight: bold;
      color: #444;
    }

    .acoes {
      display: flex;
      gap: 6px;
      min-width: 110px;
      justify-content: flex-end;
    }
    .acoes button {
      padding: 4px 8px;
      font-size: 0.8rem;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
      color: white;
      user-select: none;
    }
    .editar {
      background: #ffc107;
      color: #222;
    }
    .excluir {
      background: #dc3545;
    }

    .subtitulo {
      margin-top: 20px; font-weight: bold; color: #444;
      font-size: 1.1rem;
      margin-bottom: 8px;
    }

    .em-falta {
      color: #dc3545;
      font-weight: bold;
      font-style: italic;
      margin-left: 8px;
    }

    #buscaPedidos, #buscaEstoque {
      margin-bottom: 12px;
      font-size: 1rem;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 8px;
      width: 100%;
    }

    ul::-webkit-scrollbar {
      width: 8px;
    }
    ul::-webkit-scrollbar-thumb {
      background-color: #f28ab2;
      border-radius: 10px;
    }
  </style>
</head>
<body>

<div class="splash" id="splash">
  <h1>Doce Sabor Caseiro</h1>
  <button onclick="entrar()">Entrar</button>
</div>

<div class="container" id="app">
  <nav>
    <button onclick="mostrar('clientes')">游늶 Clientes</button>
    <button onclick="mostrar('pedidos')">游븨 Pedidos</button>
    <button onclick="mostrar('despesas')">游눶 Despesas</button>
    <button onclick="mostrar('estoque')">游닍 Estoque</button>
    <button onclick="mostrar('financeiro')">游늵 Financeiro</button>
  </nav>

  <section id="clientes" class="active">
    <h2>Cadastro de Cliente</h2>
    <input id="clienteNome" placeholder="Nome do cliente" />
    <input id="clienteTelefone" placeholder="Telefone" />
    <input id="clienteEndereco" placeholder="Endere칞o" />
    <button class="save" onclick="salvarCliente()">Salvar</button>
    <ul id="listaClientes"></ul>
  </section>

  <section id="pedidos">
    <h2>Pedidos</h2>
    <input id="pedidoCliente" placeholder="Nome do cliente" />
    <input id="tipoProduto" placeholder="Tipo de produto" />
    <input id="valorPedido" type="number" step="0.01" placeholder="Valor (R$)" />
    <select id="formaEntrega">
      <option value="Entregar">Entregar</option>
      <option value="Retirar">Retirar</option>
    </select>
    <button class="save" onclick="salvarPedido()">Salvar Pedido</button>

    <div class="subtitulo">Buscar pedido</div>
    <input id="buscaPedidos" placeholder="Digite para buscar pedidos" oninput="buscarPedidos()" />

    <ul id="listaPedidos"></ul>
  </section>

  <section id="despesas">
    <h2>Despesas</h2>
    <select id="tipoDespesa">
      <option>Mercadorias</option>
      <option>Loja</option>
      <option>Pessoais</option>
    </select>
    <input id="valorDespesa" type="number" step="0.01" placeholder="Valor (R$)" />
    <button class="save" onclick="salvarDespesa()">Salvar Despesa</button>
    <ul id="listaDespesas"></ul>
  </section>

  <section id="estoque">
    <h2>Estoque</h2>
    <input id="produtoNome" placeholder="Nome do Produto" />
    <input id="produtoQtd" type="number" placeholder="Quantidade" />
    <button class="save" onclick="adicionarProduto()">Adicionar Produto</button>

    <div class="subtitulo">Buscar produto</div>
    <input id="buscaEstoque" placeholder="Digite para buscar produtos" oninput="buscarEstoque()" />

    <ul id="listaEstoque"></ul>
  </section>

  <section id="financeiro" class="financeiro">
    <h2>Financeiro</h2>
    <p><strong>Ganhos:</strong> R$ <span id="ganhos">0.00</span></p>
    <p><strong>Gastos:</strong> R$ <span id="gastos">0.00</span></p>
    <p><strong>Lucros:</strong> R$ <span id="lucros">0.00</span></p>

    <div class="subtitulo">Relat칩rios</div>
    <label for="relatorioData">Escolha a data para relat칩rio:</label>
    <input type="date" id="relatorioData" onchange="gerarRelatorio()" />

    <div id="relatorioResultado" style="margin-top: 12px; font-weight: bold;"></div>
  </section>
</div>

<script>
  // Elementos globais
  const clienteNome = document.getElementById('clienteNome');
  const clienteTelefone = document.getElementById('clienteTelefone');
  const clienteEndereco = document.getElementById('clienteEndereco');

  const pedidoCliente = document.getElementById('pedidoCliente');
  const tipoProduto = document.getElementById('tipoProduto');
  const valorPedido = document.getElementById('valorPedido');
  const formaEntrega = document.getElementById('formaEntrega');
  const buscaPedidosInput = document.getElementById('buscaPedidos');

  const tipoDespesa = document.getElementById('tipoDespesa');
  const valorDespesa = document.getElementById('valorDespesa');

  const produtoNome = document.getElementById('produtoNome');
  const produtoQtd = document.getElementById('produtoQtd');
  const buscaEstoqueInput = document.getElementById('buscaEstoque');

  const ganhosSpan = document.getElementById('ganhos');
  const gastosSpan = document.getElementById('gastos');
  const lucrosSpan = document.getElementById('lucros');

  const relatorioDataInput = document.getElementById('relatorioData');
  const relatorioResultado = document.getElementById('relatorioResultado');

  // Estado de edi칞칚o
  let clienteEditando = null;
  let pedidoEditando = null;
  let produtoEditando = null;

  // Mostrar se칞칚o
  function mostrar(secao) {
    document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
    document.getElementById(secao).classList.add('active');
    // Atualiza dados ao trocar aba
    if(secao === 'clientes') listarClientes();
    else if(secao === 'pedidos') listarPedidos();
    else if(secao === 'estoque') listarEstoque();
    else if(secao === 'despesas') listarDespesas();
    else if(secao === 'financeiro') {
      atualizarFinanceiro();
      relatorioResultado.innerHTML = '';
      relatorioDataInput.value = '';
    }
  }

  // Entrar (splash)
  function entrar() {
    document.getElementById('splash').style.display = 'none';
    document.getElementById('app').style.display = 'block';
    mostrar('clientes');  // Mostra clientes por padr칚o ap칩s entrar
  }

  // ---------- CLIENTES ----------
  function salvarCliente() {
    const nome = clienteNome.value.trim();
    const telefone = clienteTelefone.value.trim();
    const endereco = clienteEndereco.value.trim();
    if (!nome || !telefone || !endereco) {
      alert('Preencha todos os campos');
      return;
    }

    let clientes = JSON.parse(localStorage.getItem('clientes') || '[]');

    if (clienteEditando !== null) {
      clientes[clienteEditando] = { nome, telefone, endereco };
      clienteEditando = null;
    } else {
      clientes.push({ nome, telefone, endereco });
    }
    localStorage.setItem('clientes', JSON.stringify(clientes));

    clienteNome.value = clienteTelefone.value = clienteEndereco.value = '';
    listarClientes();
  }

  function listarClientes() {
    const lista = document.getElementById('listaClientes');
    lista.innerHTML = '';
    const clientes = JSON.parse(localStorage.getItem('clientes') || '[]');

    clientes.forEach((c, i) => {
      const li = document.createElement('li');
      li.textContent = `${c.nome} - ${c.telefone} (${c.endereco})`;
      lista.appendChild(li);
    });
  }

  // ---------- PEDIDOS ----------
  function salvarPedido() {
    const nome = pedidoCliente.value.trim();
    const produto = tipoProduto.value.trim();
    const valor = parseFloat(valorPedido.value);
    const entrega = formaEntrega.value;
    if (!nome || !produto || isNaN(valor)) {
      alert('Preencha todos os campos corretamente');
      return;
    }

    let pedidos = JSON.parse(localStorage.getItem('pedidos') || '[]');

    // Incluindo data atual no pedido para relat칩rios
    const data = new Date().toISOString();

    if (pedidoEditando !== null) {
      pedidos[pedidoEditando] = { nome, produto, valor, entrega, data };
      pedidoEditando = null;
    } else {
      pedidos.push({ nome, produto, valor, entrega, data });
    }

    localStorage.setItem('pedidos', JSON.stringify(pedidos));

    pedidoCliente.value = tipoProduto.value = valorPedido.value = '';
    formaEntrega.value = 'Entregar';
    buscaPedidosInput.value = '';
    listarPedidos();
    atualizarFinanceiro();
  }

  function listarPedidos(filtrar = '') {
    const lista = document.getElementById('listaPedidos');
    lista.innerHTML = '';
    const pedidos = JSON.parse(localStorage.getItem('pedidos') || '[]');

    pedidos.forEach((p, i) => {
      if(filtrar && !p.nome.toLowerCase().includes(filtrar.toLowerCase()) && !p.produto.toLowerCase().includes(filtrar.toLowerCase())) return;

      const li = document.createElement('li');

      li.innerHTML = `
        ${p.nome} - ${p.produto} - R$${p.valor.toFixed(2)} (${p.entrega})
        <div class="acoes">
          <button class="editar" onclick="editarPedido(${i})">Editar</button>
          <button class="excluir" onclick="excluirPedido(${i})">Excluir</button>
        </div>
      `;

      lista.appendChild(li);
    });
  }

  function buscarPedidos() {
    const termo = buscaPedidosInput.value.trim();
    listarPedidos(termo);
  }

  function editarPedido(index) {
    const pedidos = JSON.parse(localStorage.getItem('pedidos') || '[]');
    const p = pedidos[index];
    pedidoCliente.value = p.nome;
    tipoProduto.value = p.produto;
    valorPedido.value = p.valor;
    formaEntrega.value = p.entrega;
    pedidoEditando = index;
  }

  function excluirPedido(index) {
    if (!confirm('Deseja realmente excluir este pedido?')) return;
    let pedidos = JSON.parse(localStorage.getItem('pedidos') || '[]');
    pedidos.splice(index, 1);
    localStorage.setItem('pedidos', JSON.stringify(pedidos));
    listarPedidos();
    atualizarFinanceiro();
  }

  // ---------- DESPESAS ----------
  function salvarDespesa() {
    const tipo = tipoDespesa.value;
    const valor = parseFloat(valorDespesa.value);
    if (!tipo || isNaN(valor)) {
      alert('Preencha todos os campos corretamente');
      return;
    }

    const data = new Date().toISOString();

    let despesas = JSON.parse(localStorage.getItem('despesas') || '[]');
    despesas.push({ tipo, valor, data });
    localStorage.setItem('despesas', JSON.stringify(despesas));

    valorDespesa.value = '';
    listarDespesas();
    atualizarFinanceiro();
  }

  function listarDespesas() {
    const lista = document.getElementById('listaDespesas');
    lista.innerHTML = '';
    const despesas = JSON.parse(localStorage.getItem('despesas') || '[]');

    despesas.forEach(d => {
      const li = document.createElement('li');
      li.textContent = `${d.tipo} - R$${d.valor.toFixed(2)}`;
      lista.appendChild(li);
    });
  }

  // ---------- ESTOQUE ----------
  function adicionarProduto() {
    const nome = produtoNome.value.trim();
    const qtd = parseInt(produtoQtd.value);
    if (!nome || isNaN(qtd) || qtd < 0) {
      alert('Preencha todos os campos corretamente');
      return;
    }

    let estoque = JSON.parse(localStorage.getItem('estoque') || '[]');

    if (produtoEditando !== null) {
      estoque[produtoEditando] = { nome, qtd };
      produtoEditando = null;
    } else {
      // Se produto j치 existe, soma quantidade
      const idx = estoque.findIndex(p => p.nome.toLowerCase() === nome.toLowerCase());
      if (idx >= 0) {
        estoque[idx].qtd += qtd;
      } else {
        estoque.push({ nome, qtd });
      }
    }

    localStorage.setItem('estoque', JSON.stringify(estoque));

    produtoNome.value = produtoQtd.value = '';
    buscaEstoqueInput.value = '';
    listarEstoque();
  }

  function listarEstoque(fil