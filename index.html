<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Dashboard Jurídico 2025</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif;}
body{
  background:linear-gradient(145deg,#0d1b2a,#1b263b);
  color:#e0e1dd;display:flex;min-height:100vh;overflow-x:hidden;
}
aside{
  width:240px;background:#1b263b;padding:25px 15px;
  display:flex;flex-direction:column;align-items:flex-start;
  position:fixed;height:100%;box-shadow:3px 0 10px rgba(0,0,0,.3);
}
aside h2{color:#00b4d8;margin-bottom:25px;}
aside a{
  text-decoration:none;color:#e0e1dd;margin:8px 0;width:100%;
  padding:10px;border-radius:8px;transition:.3s;
}
aside a:hover,aside a.active{background:#00b4d8;color:#fff;}
main{margin-left:260px;padding:30px;width:calc(100% - 260px);}
section{display:none;}
section.active{display:block;}
h1,h2{color:#fff;}
.filtros{margin-bottom:15px;}
.filtros select{
  background:#1b263b;color:#fff;border:none;padding:8px 12px;border-radius:6px;margin-right:10px;
}
.cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:20px;margin-bottom:20px;}
.card{
  background:linear-gradient(145deg,#1e2a47,#24345c);
  border-radius:12px;padding:18px;color:#fff;
  box-shadow:inset 0 0 10px rgba(0,180,216,.3),0 0 8px rgba(0,0,0,.5);
}
.card h3{font-size:1rem;color:#90e0ef;margin-bottom:6px;}
.card p{font-size:1.5rem;font-weight:600;}
.chartBox{background:#1b263b;padding:20px;border-radius:15px;
  box-shadow:0 0 12px rgba(0,0,0,.4);margin-bottom:25px;}
canvas{width:100%!important;height:280px!important;}
.ranking{background:linear-gradient(145deg,#14213d,#1b263b);
  padding:20px;border-radius:15px;box-shadow:0 0 10px rgba(0,180,216,.3);}
.ranking h3{color:#00b4d8;margin-bottom:10px;}
.ranking ul{list-style:none;}
.ranking li{background:#1e2a47;margin:8px 0;padding:8px 15px;border-radius:8px;
  display:flex;justify-content:space-between;}
</style>
</head>
<body>

<aside>
  <h2>⚖️ Jurídico</h2>
  <a class="active" data-target="dashboard">Dashboard</a>
  <a data-target="funil">Funil Precatórios</a>
  <a data-target="crm">CRM Precatório</a>
  <a data-target="funilgeral">Funil Geral</a>
  <a data-target="ranking">Ranking</a>
  <a data-target="sla">SLA</a>
  <a data-target="processos">Processos</a>
  <a data-target="distratos">Distratos</a>
  <a data-target="pdi">PDI</a>
</aside>

<main>
  <div class="filtros">
    <select id="filtroMes">
      <option value="Todos">Todos os Meses</option>
      <option>Janeiro</option><option>Fevereiro</option><option>Março</option>
      <option>Abril</option><option>Maio</option><option>Junho</option>
      <option>Julho</option><option>Agosto</option><option>Setembro</option>
      <option>Outubro</option><option>Novembro</option><option>Dezembro</option>
    </select>
    <select id="filtroArea">
      <option value="Todas">Todas as Áreas</option>
      <option>Precatório</option><option>Bancário</option><option>Trabalhista</option>
      <option>Previdenciário</option>
    </select>
  </div>

  <!-- ABA 1 -->
  <section id="dashboard" class="active">
    <h1>Dashboard Jurídico 2025</h1>
    <div class="cards" id="cardsDashboard"></div>
    <div class="chartBox"><h2>Status dos Processos</h2><canvas id="graficoStatus"></canvas></div>
    <div class="chartBox"><h2>Evolução Anual</h2><canvas id="graficoLinha"></canvas></div>
  </section>

  <!-- ABA 2 -->
  <section id="funil">
    <h1>Funil Precatórios</h1>
    <div class="cards" id="cardsFunil"></div>
    <div class="chartBox"><h2>Top 5 Status x Motivos</h2><canvas id="graficoFunil"></canvas></div>
  </section>

  <!-- ABA 3 -->
  <section id="crm">
    <h1>CRM Precatório</h1>
    <div class="cards" id="cardsCRM"></div>
    <div class="chartBox"><h2>Produção Diária</h2><canvas id="graficoCRM"></canvas></div>
  </section>

  <!-- ABA 4 -->
  <section id="funilgeral">
    <h1>Funil Geral</h1>
    <div class="cards" id="cardsGeral"></div>
    <div class="chartBox"><h2>Conversão por Área</h2><canvas id="graficoGeral"></canvas></div>
  </section>

  <!-- ABA 5 -->
  <section id="ranking">
    <h1>Ranking e Performance</h1>
    <div class="cards" id="cardsRanking"></div>
    <div class="chartBox"><h2>Ranking Mensal</h2><canvas id="graficoRanking"></canvas></div>
  </section>

  <!-- ABA 6 -->
  <section id="sla">
    <h1>SLA — Contratos Assinados x Distribuídos</h1>
    <div class="cards" id="cardsSLA"></div>
    <div class="chartBox"><h2>Evolução Mensal</h2><canvas id="graficoSLA"></canvas></div>
  </section>

  <!-- ABA 7 -->
  <section id="processos">
    <h1>Controle de Processos</h1>
    <div class="cards" id="cardsProc"></div>
    <div class="chartBox"><h2>Resultado Geral</h2><canvas id="graficoProc"></canvas></div>
  </section>

  <!-- ABA 8 -->
  <section id="distratos">
    <h1>Distratos</h1>
    <div class="cards" id="cardsDistr"></div>
    <div class="chartBox"><h2>Percentual Mensal</h2><canvas id="graficoDistr"></canvas></div>
  </section>

  <!-- ABA 9 -->
  <section id="pdi">
    <h1>PDI - Resultado Mensal</h1>
    <div class="cards" id="cardsPDI"></div>
    <div class="chartBox"><h2>Desempenho por Colaborador</h2><canvas id="graficoPDI"></canvas></div>
  </section>
</main>

<script>
const SHEET_ID="1baSrMHddB1BeFEjhkBpR0ES4ZIF5EJ9MIWnK83NW9hc";
const API_KEY="AIzaSyC4AuWdBjcwRoZnkQjhIPxBQKpvKhyjir0";

// Navegação entre abas
document.querySelectorAll("aside a").forEach(link=>{
  link.addEventListener("click",()=>{
    document.querySelectorAll("aside a").forEach(l=>l.classList.remove("active"));
    link.classList.add("active");
    const alvo=link.getAttribute("data-target");
    document.querySelectorAll("main section").forEach(sec=>sec.classList.remove("active"));
    document.getElementById(alvo).classList.add("active");
  });
});

// Corrigido: agora busca a aba correta sem acento
async function carregarDashboard(){
  const range="FUNIL PRECATÓRIO_INICIO MARÇO25";
  const url=`https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${encodeURIComponent(range)}?key=${API_KEY}`;
  const res=await fetch(url);
  const data=await res.json();
  const linhas=data.values;
  if(!linhas||linhas.length<2)return;
  const headers=linhas[1];
  const registros=linhas.slice(2).map(l=>{
    const obj={};headers.forEach((h,i)=>obj[h]=l[i]||"");return obj;
  });
  atualizarDashboard(registros);
}

function atualizarDashboard(registros){
  const total=registros.length;
  const prioridade={Alta:0,Média:0,Baixa:0};
  const status={},linha={};

  registros.forEach(r=>{
    const p=(r["PRIORIDADE: ALTA,MÉDIA OU BAIXA"]||"").trim();
    if(p) prioridade[p]=(prioridade[p]||0)+1;
    const s=(r["STATUS"]||"").trim();
    if(s) status[s]=(status[s]||0)+1;
    const d=(r["DATA DO PRIMEIRO CONTATO COM O CLIENTE"]||"").slice(0,10);
    if(d) linha[d]=(linha[d]||0)+1;
  });

  document.getElementById("cardsDashboard").innerHTML=`
    <div class='card'><h3>Total de Leads</h3><p>${total}</p></div>
    <div class='card'><h3>Alta</h3><p>${prioridade.Alta||0}</p></div>
    <div class='card'><h3>Média</h3><p>${prioridade.Média||0}</p></div>
    <div class='card'><h3>Baixa</h3><p>${prioridade.Baixa||0}</p></div>`;

  new Chart(document.getElementById("graficoStatus"),{
    type:"bar",
    data:{labels:Object.keys(status),datasets:[{data:Object.values(status),backgroundColor:"#00b4d8",borderRadius:8}]},
    options:{plugins:{legend:{display:false}},scales:{x:{ticks:{color:"#fff"}},y:{ticks:{color:"#fff"}}}}
  });

  const ordenado=Object.entries(linha).sort((a,b)=>new Date(a[0])-new Date(b[0]));
  new Chart(document.getElementById("graficoLinha"),{
    type:"line",
    data:{labels:ordenado.map(e=>e[0]),datasets:[{data:ordenado.map(e=>e[1]),borderColor:"#00b4d8",backgroundColor:"rgba(0,180,216,.2)",fill:true,tension:.3}]},
    options:{plugins:{legend:{display:false}},scales:{x:{ticks:{color:"#fff"}},y:{ticks:{color:"#fff"}}}}
  });
}

carregarDashboard();
</script>
</body>
</html>
